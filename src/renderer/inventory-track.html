<!DOCTYPE html><html lang="ar" dir="rtl"><head><meta charset="UTF-8"><title>تتبع حركة المخزون</title><style>*{box-sizing:border-box;font-family:Tahoma,Arial,sans-serif;}body{margin:0;background:#eef3f7;color:#0d2d3a;}header{display:flex;align-items:center;gap:12px;padding:12px 18px;border-bottom:2px solid #000;background:#fff;}h1{margin:0;font-size:20px;font-weight:800;}button.btn{cursor:pointer;font-size:13px;font-weight:700;padding:9px 18px;border:2px solid #000;background:#fff;border-radius:14px;transition:.25s;}button.btn:hover{background:#eaf4ff;transform:translateY(-2px);}main{display:grid;grid-template-columns:320px 1fr;gap:18px;padding:18px;}fieldset{border:2px solid #000;border-radius:20px;padding:14px 16px;}legend{padding:0 6px;font-weight:800;font-size:13px;}label{display:flex;flex-direction:column;font-size:12px;font-weight:700;gap:4px;margin-bottom:10px;}input,select{border:2px solid #000;border-radius:12px;padding:8px 10px;font-size:13px;font-weight:600;}table{width:100%;border-collapse:separate;border-spacing:0;min-width:720px;}th,td{border:2px solid #000;padding:6px 8px;font-size:12px;text-align:center;background:#fff;}th{background:#f0f3f6;font-weight:800;}tbody tr:nth-child(even) td{background:#fafafa;}tbody tr:hover td{background:#e7f2fa;}#metaBox{font-size:12px;font-weight:600;line-height:1.5;min-height:40px;}::-webkit-scrollbar{width:10px;height:10px;}::-webkit-scrollbar-track{background:#e2e8ef;border-radius:8px;}::-webkit-scrollbar-thumb{background:#97b4c7;border:2px solid #e2e8ef;border-radius:8px;}::-webkit-scrollbar-thumb:hover{background:#6f95ac;}</style></head><body><header><button id="backBtn" class="btn">⟵ رجوع</button><h1>تتبع حركة المخزون</h1><div style="flex:1"></div><button id="reloadBtn" class="btn">تحديث</button></header><main><div style="display:flex;flex-direction:column;gap:16px;"> <fieldset><legend>بحث منتج</legend><label>بحث<input type="text" id="searchBox" placeholder="اسم / باركود"/></label><div style="max-height:280px;overflow:auto;border:2px solid #000;border-radius:16px;background:#fff;"> <table style="min-width:520px;"><thead><tr><th>ID</th><th>اسم</th><th>كمية</th><th>مخزن</th></tr></thead><tbody id="prodList"></tbody></table></div></fieldset><fieldset><legend>معلومات</legend><div id="metaBox">—</div><button id="openMov" class="btn" disabled>سجل الحركة</button></fieldset></div><div style="overflow:auto;"> <table><thead><tr><th>#</th><th>التغير</th><th>السبب</th><th>مرجع</th><th>التاريخ</th></tr></thead><tbody id="movBody"></tbody></table></div></main><script src="navigation.js"></script><script>(function(){const search=document.getElementById('searchBox');const prodList=document.getElementById('prodList');const movBody=document.getElementById('movBody');const meta=document.getElementById('metaBox');const openMov=document.getElementById('openMov');let products=[];let current=null;async function loadProducts(){const r=await window.api.productsList(search.value.trim());if(r.ok){products=r.rows.slice(0,200);renderProducts();}}function renderProducts(){prodList.innerHTML=products.map(p=>`<tr data-id="${p.id}" style="cursor:pointer;"><td>${p.id}</td><td>${p.name||''}</td><td>${p.qty||0}</td><td>${p.store_id||''}</td></tr>`).join('')||'<tr><td colspan="4">لا يوجد</td></tr>';}prodList.addEventListener('click',e=>{const tr=e.target.closest('tr[data-id]');if(!tr)return;current=products.find(p=>p.id==tr.dataset.id);if(!current)return;meta.innerHTML=`<div><b>${current.name}</b></div><div>كمية: ${current.qty||0}</div><div>باركود: ${current.barcode||''}</div>`;openMov.disabled=false;loadMov();});async function loadMov(){if(!current){movBody.innerHTML='';return;}movBody.innerHTML='<tr><td colspan="5">تحميل...</td></tr>';const r=await window.api.productStockMovements(current.id,150);if(r.ok){movBody.innerHTML=r.rows.map(m=>`<tr><td>${m.id}</td><td style="color:${m.change>0?'#0a7d32':'#b20000'};font-weight:700;">${m.change>0? '+'+m.change: m.change}</td><td>${m.reason||''}</td><td>${m.ref_id||''}</td><td>${(m.created_at||'').replace('T',' ').slice(0,16)}</td></tr>`).join('')||'<tr><td colspan="5">لا يوجد</td></tr>';}else movBody.innerHTML='<tr><td colspan="5">فشل</td></tr>';}search.addEventListener('input',loadProducts);document.getElementById('reloadBtn').addEventListener('click',()=>{loadProducts(); if(current) loadMov();});document.getElementById('backBtn').addEventListener('click',()=>window.location.href='index.html');openMov.addEventListener('click',loadMov);loadProducts();})();</script></body></html>
