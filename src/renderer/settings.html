<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>الإعدادات</title>
  <link rel="stylesheet" href="../renderer/styles.css">
  <link rel="stylesheet" href="settings.css">
</head>
<body class="dashboard-mode settings-page">
  <div class="page-head">
    <h1>لوحة الإعدادات</h1>
    <p class="sub">إدارة تفضيلات التطبيق، البيانات الضريبية، المظهر، الطباعة والمزيد – كل شيء في مكان واحد.</p>
  </div>
  <div class="layout">
    <aside class="side">
      <header>
        <h2>القائمة</h2>
        <button id="backBtn" class="back-link" title="رجوع">رجوع</button>
      </header>
      <ul class="tabs-list" id="tabsList">
        <li><button data-tab="company" class="active">المنشأة</button></li>
  <li><button data-tab="sales">المبيعات</button></li>
  <li><button data-tab="backup">النسخ الاحتياطي</button></li>
        <li><button data-tab="printing">الطباعة</button></li>
    <li><button data-tab="security">الأمان</button></li>
        <li><button data-tab="system">النظام</button></li>
  <li><button data-tab="employees" class="tab-employees-guard">الموظفون والصلاحيات</button></li>
      </ul>
    </aside>
    <main class="content">
      <!-- المنشأة -->
      <section class="panel active" id="panel-company">
        <h3>بيانات المنشأة</h3>
        <div class="grid">
          <label class="field">اسم المنشأة
            <input type="text" id="companyName" placeholder="مؤسسة / شركة" />
          </label>
          <label class="field">الهاتف
            <input type="text" id="companyPhone" placeholder="05xxxxxxxx" />
          </label>
          <label class="field">العنوان
            <input type="text" id="companyAddress" placeholder="مدينة - شارع" />
          </label>
          <label class="field">البريد الإلكتروني
            <input type="text" id="companyEmail" placeholder="info@example.com" />
          </label>
          <label class="field">وصف النشاط التجاري
            <textarea id="companyDescription" placeholder="مثال: تجارة الجملة والتجزئة" rows="2"></textarea>
          </label>
          <label class="field">الرقم الضريبي
            <input type="text" id="vatNumber" placeholder="123456789" />
          </label>
          <label class="field">السجل التجاري
            <input type="text" id="crNumber" placeholder="1010xxxxx" />
          </label>
          <label class="field">نسبة الضريبة (%)
            <input type="number" id="vatRate" placeholder="15" />
          </label>
          <label class="field">ختم / صورة صغيرة
            <input type="file" id="stampImagePicker" accept="image/*" />
            <input type="hidden" id="stampImageData" />
            <small>ستظهر في الفاتورة بمربع أصغر من QR</small>
            <div class="mini-preview" id="stampPreview">معاينة</div>
          </label>
        </div>
        <div class="save-bar"><button class="btn outline" data-save="company">حفظ</button></div>
      </section>
      <!-- المبيعات -->
      <section class="panel" id="panel-sales">
        <h3>إعدادات المبيعات</h3>
        <div class="grid cols-4">
          <label class="field">عميل افتراضي
            <input type="text" id="defaultCustomer" placeholder="العميل النقدي" />
          </label>
          <label class="field">حد أدنى للخصم (%)
            <input type="number" id="minDiscount" placeholder="0" />
          </label>
          <label class="field">حد أقصى للخصم (%)
            <input type="number" id="maxDiscount" placeholder="50" />
          </label>
          <label class="field">تنسيق الفاتورة
            <input type="text" id="invoiceFormat" placeholder="INV-{YYYY}-{####}" />
          </label>
          <label class="field" style="grid-column:1/-1;">
            تذييل الفاتورة (ملاحظة تظهر أسفل الفاتورة)
            <textarea id="invoiceFooterNote" rows="2" placeholder="مثال: البضاعة المباعة لا تُرد ولا تُستبدل"></textarea>
            <small>يُعرض في أسفل نسخة الفاتورة المطبوعة / PDF عند الحفظ.</small>
          </label>
        </div>
        <div class="inline-check"><input type="checkbox" id="autoPrintAfterSale"/> <span>طباعة تلقائية بعد الحفظ</span></div>
        <div class="inline-check"><input type="checkbox" id="allowNegativeSale"/> <span>السماح بالبيع بالسالب</span></div>
        <div class="save-bar"><button class="btn outline" data-save="sales">حفظ</button></div>
      </section>
      <!-- النسخ الاحتياطي -->
      <section class="panel" id="panel-backup">
        <h3>النسخ الاحتياطي</h3>
        <div class="grid">
          <label class="field">مسار الحفظ
            <input type="text" id="backupPath" placeholder="backup/" />
            <button type="button" class="btn mini-btn" id="chooseBackupFolder" style="margin-top:7px;">اختيار مجلد...</button>
          </label>
          <label class="field">عدد النسخ للاحتفاظ
            <input type="number" id="backupKeep" placeholder="5" />
          </label>
          <label class="field">دورية النسخ (ساعات)
            <input type="number" id="backupInterval" placeholder="24" />
          </label>
        </div>
        <div class="inline-check"><input type="checkbox" id="autoBackup"/> <span>تفعيل النسخ التلقائي</span></div>
        <div class="top-actions" style="margin-top:18px;gap:14px;">
          <button type="button" class="btn outline" id="exportDataBtn">تصدير البيانات</button>
          <button type="button" class="btn outline" id="importDataBtn">استيراد البيانات</button>
        </div>
        <small style="opacity:.7;display:block;margin-top:8px;">التنفيذ المجدول لاحقاً – حالياً يتم حفظ الإعداد فقط.</small>
        <div class="save-bar"><button class="btn outline" data-save="backup">حفظ</button></div>
      </section>
      <!-- الطباعة -->
      <section class="panel" id="panel-printing">
        <h3>إعدادات الطباعة</h3>
        <div class="grid">
          <label class="field">الطابعة الافتراضية
            <div style="display:flex;gap:6px;align-items:center;">
              <select id="defaultPrinterSelect" style="flex:1;min-width:200px;">
                <option value="">(لم يتم التحميل بعد)</option>
              </select>
              <button type="button" class="mini-btn" id="refreshPrintersBtn">تحديث</button>
            </div>
            <small style="opacity:.7;display:block;margin-top:4px;">تُستخدم للطباعة التلقائية الصامتة. اتركها فارغة لعرض حوار اختيار الطابعة.</small>
          </label>
        </div>
        <div class="save-bar"><button class="btn outline" data-save="printing">حفظ</button></div>
      </section>
      <!-- الأمان -->
      <section class="panel" id="panel-security">
        <h3>الأمان</h3>
        <div class="grid">
          <label class="field">قفل تلقائي (دقائق خمول)
            <input type="number" id="autoLogoutMin" placeholder="30" />
          </label>
        </div>
        <div class="inline-check"><input type="checkbox" id="requirePasswordForDelete"/> <span>طلب كلمة المرور عند الحذف</span></div>
        <div class="danger-zone" style="margin-top:18px;">
          <h4>منطقة حساسة</h4>
          <p style="margin:0 0 10px;font-size:12px;">إعادة تعيين كافة الإعدادات للسماح بالبدء من جديد (لا يحذف البيانات الأساسية).</p>
          <button type="button" id="resetSettings" class="mini-btn">إعادة ضبط الإعدادات</button>
        </div>
        <div class="save-bar"><button class="btn outline" data-save="security">حفظ</button></div>
      </section>
      <!-- النظام -->
      <section class="panel" id="panel-system">
        <h3>معلومات النظام</h3>
        <div class="system-info">
          <div class="info-box" style="color:#000;">إصدار التطبيق<br><b id="appVersion" style="color:#000;">...</b></div>
          <div class="info-box" style="color:#000;">حجم قاعدة البيانات<br><b id="dbSize" style="color:#000;">...</b></div>
        </div>
        <div class="grid" style="margin-top:22px;">
          <label class="field">اللغة الافتراضية
            <select id="appLang"><option value="ar">العربية</option><option value="en">English</option></select>
          </label>
          <label class="field">صيغة التاريخ
            <select id="dateFormat"><option value="YYYY-MM-DD">YYYY-MM-DD</option><option value="DD/MM/YYYY">DD/MM/YYYY</option><option value="MM/DD/YYYY">MM/DD/YYYY</option></select>
          </label>
        </div>
        <div class="save-bar"><button class="btn outline" data-save="system">حفظ</button></div>
      </section>
      <!-- الموظفون والصلاحيات -->
      <section class="panel" id="panel-employees">
        <h3>الموظفون والصلاحيات</h3>
        <p style="margin-top:-4px;font-size:12.5px;opacity:.75">أضف موظفين وحدد صلاحياتهم بالاختيار. انقر على صف مستخدم لتحميله في النموذج.</p>
        <div class="grid cols-4" style="align-items:flex-end;">
          <label class="field">اسم المستخدم
            <input type="text" id="empUsername" placeholder="مثال: cashier1" />
          </label>
          <label class="field">الرقم السري
            <input type="password" id="empPassword" placeholder="••••" />
          </label>
          <label class="field">الحالة
            <select id="empActive"><option value="1">مفعل</option><option value="0">معطل</option></select>
          </label>
          <div class="field" style="display:flex;flex-direction:column;gap:6px;">
            <span style="font-size:11px;font-weight:600;">إجراءات</span>
            <button type="button" class="mini-btn" id="btnAddEmp">حفظ / تحديث</button>
            <button type="button" class="mini-btn outline" id="btnResetEmpForm">تفريغ</button>
          </div>
        </div>
        <fieldset style="border:1px solid #ccc;padding:10px 12px;margin-top:12px;border-radius:8px;">
          <legend style="font-size:12px;padding:0 6px;">الصلاحيات</legend>
          <div class="perm-grid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:6px 18px;font-size:12.5px;">
            <label><input type="checkbox" class="perm" data-bit="1"/> مبيعات</label>
            <label><input type="checkbox" class="perm" data-bit="2"/> منتجات</label>
            <label><input type="checkbox" class="perm" data-bit="4"/> عملاء</label>
            <label><input type="checkbox" class="perm" data-bit="8"/> موردون</label>
            <label><input type="checkbox" class="perm" data-bit="16"/> تقارير</label>
            <label><input type="checkbox" class="perm" data-bit="32"/> إعدادات</label>
            <label><input type="checkbox" class="perm" data-bit="64"/> مخزون</label>
            <label><input type="checkbox" class="perm" data-bit="128"/> ديون</label>
            <label><input type="checkbox" class="perm" data-bit="256"/> إدارة المستخدمين</label>
            <label><input type="checkbox" class="perm" data-bit="512"/> تعديل/حذف فواتير</label>
            <label><input type="checkbox" class="perm" data-bit="1024"/> مالية ومصروفات</label>
          </div>
        </fieldset>
        <h4 style="margin:18px 0 8px;">المستخدمون</h4>
        <table class="generic" style="width:100%;border-collapse:collapse;font-size:12.5px;" id="empTable">
          <thead><tr style="background:#f1f5f9;"><th>ID</th><th>اسم المستخدم</th><th>الدور</th><th>فعال</th><th>صلاحيات</th><th>تحميل</th></tr></thead>
          <tbody></tbody>
        </table>
      </section>
      <div class="save-bar" style="justify-content:center;margin-top:10px;">
        <button class="btn" id="saveAll">حفظ كل الإعدادات</button>
      </div>
    </main>
  </div>
  <script src="../renderer/settings.js"></script>
</body>
</html>
