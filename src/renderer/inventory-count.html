<!DOCTYPE html><html lang="ar" dir="rtl"><head><meta charset="UTF-8"><title>جرد سريع</title><style>*{box-sizing:border-box;font-family:Tahoma,Arial,sans-serif;}body{margin:0;background:#f3f7fb;color:#0d2d3a;}header{display:flex;align-items:center;gap:12px;padding:12px 18px;border-bottom:2px solid #000;background:#fff;}h1{margin:0;font-size:20px;font-weight:800;}button.btn{cursor:pointer;font-size:13px;font-weight:700;padding:9px 18px;border:2px solid #000;background:#fff;border-radius:14px;transition:.25s;}button.btn:hover{background:#eaf4ff;transform:translateY(-2px);}main{padding:18px;display:grid;gap:18px;grid-template-columns:340px 1fr;}fieldset{border:2px solid #000;border-radius:20px;padding:14px 16px;}legend{padding:0 6px;font-weight:800;font-size:13px;}label{display:flex;flex-direction:column;font-size:12px;font-weight:700;gap:4px;margin-bottom:10px;}input{border:2px solid #000;border-radius:12px;padding:8px 10px;font-size:13px;font-weight:600;}table{width:100%;border-collapse:separate;border-spacing:0;min-width:740px;}th,td{border:2px solid #000;padding:6px 8px;font-size:12px;text-align:center;background:#fff;}th{background:#f0f3f6;font-weight:800;}tbody tr:nth-child(even) td{background:#fafafa;}tbody tr:hover td{background:#e7f2fa;}#log{font-size:11.5px;font-weight:600;line-height:1.4;max-height:160px;overflow:auto;border:2px dashed #000;border-radius:16px;padding:8px 10px;background:#fff;}::-webkit-scrollbar{width:10px;height:10px;}::-webkit-scrollbar-track{background:#e2e8ef;border-radius:8px;}::-webkit-scrollbar-thumb{background:#97b4c7;border:2px solid #e2e8ef;border-radius:8px;}::-webkit-scrollbar-thumb:hover{background:#6f95ac;}</style></head><body><header><button id="backBtn" class="btn">⟵ رجوع</button><h1>جرد سريع</h1><div style="flex:1"></div><button id="reloadBtn" class="btn">تحديث</button></header><main><div style="display:flex;flex-direction:column;gap:16px;"><fieldset><legend>إدخال</legend><label>بحث (اسم/باركود)<input type="text" id="searchBox" autofocus /></label><label>إدخال كمية (يُستبدل بها الحالية)<input type="number" id="qtyInput" /></label><button class="btn" id="applyBtn" disabled>تطبيق</button></fieldset><fieldset><legend>محدد</legend><div id="selBox" style="font-size:12px;font-weight:600;min-height:40px;">—</div></fieldset><fieldset><legend>السجل</legend><div id="log">—</div></fieldset></div><div style="overflow:auto;"> <table><thead><tr><th>ID</th><th>اسم</th><th>باركود</th><th>كمية</th><th>مخزن</th></tr></thead><tbody id="prodBody"></tbody></table></div></main><script src="navigation.js"></script><script>(function(){const search=document.getElementById('searchBox');const qtyInput=document.getElementById('qtyInput');const applyBtn=document.getElementById('applyBtn');const prodBody=document.getElementById('prodBody');const selBox=document.getElementById('selBox');const log=document.getElementById('log');let rows=[],selected=null;function logMsg(m){const t=new Date().toLocaleTimeString();log.innerHTML=`<div>[${t}] ${m}</div>`+log.innerHTML;}async function load(){const r=await window.api.productsList(search.value.trim());if(r.ok){rows=r.rows.slice(0,300);render();}}function render(){prodBody.innerHTML=rows.map(p=>`<tr data-id="${p.id}" style="cursor:pointer;"><td>${p.id}</td><td>${p.name||''}</td><td>${p.barcode||''}</td><td>${p.qty||0}</td><td>${p.store_id||''}</td></tr>`).join('')||'<tr><td colspan="5">لا يوجد</td></tr>';}prodBody.addEventListener('click',e=>{const tr=e.target.closest('tr[data-id]');if(!tr)return;selected=rows.find(r=>r.id==tr.dataset.id);if(!selected)return;selBox.innerHTML=`<b>${selected.name}</b><br>الكمية الحالية: ${selected.qty||0}`;qtyInput.value=selected.qty||0;applyBtn.disabled=false;});applyBtn.addEventListener('click',async()=>{if(!selected)return;const user=JSON.parse(sessionStorage.getItem('asas_user')||'{}');const val=parseFloat(qtyInput.value);if(isNaN(val)){alert('كمية غير صالحة');return;}const r=await window.api.inventoryAdjust({product_id:selected.id,new_qty:val,note:'جرد سريع',user_id:user.id});if(r.ok){logMsg('تحديث '+selected.name+' إلى '+val);load();}else logMsg('فشل: '+(r.msg||''));});search.addEventListener('input',load);document.getElementById('reloadBtn').addEventListener('click',load);document.getElementById('backBtn').addEventListener('click',()=>window.location.href='index.html');load();})();</script></body></html>
